# .dockstore.yml for Xena
# https://github.com/Ldcabansay/xenahub
version: 1.1
service:
  subclass: docker-compose
  name: UCSC Xena Browser
  author: UCSC Genomics Institute
  description: |
    The UCSC Xena browser is an exploration tool for public and private,
    multi-omic and clinical/phenotype data.
    It is recommended that you configure a reverse proxy to handle HTTPS
  files:
     - docker-compose.yml 
     - README.md
  scripts:
    prerun:
    run:
        - docker-compose up -d 
        # or
        - docker-compose -e HTTP_PORT=$(parameters.httpPort) -e HTTPS_PORT=$(parameters.httpsPort) up -d 
        - # Wait until server is responding:
        - timeout 300 bash -c 'while [[ "$(curl -s -o /dev/null -w ''%{http_code}'' localhost:$(parameters.HTTP_PORT)/ping/)" != "200" ]]; do sleep 5; done' || false
    afterrun:
        - docker exec xena java -jar /ucsc_xena/cavm-0.24.0-standalone.jar --load /root/xena/files/$(parameters.dataset.data.name)

  parameters:
    # Thinking that the httpPort should be a required parameter
    - httpPort:
        type: int?
        default: 7222
        description: The host's HTTP port.
    - httpsPort:
        type: int?
        default: 7223
        description: The host's HTTPS port
    - dataset:
        scope: script
        type: dataset
        multiple: true
        - data:
            type:  file
            description: Data for Xena in TSV format
            targetDirectory: xena/files
        - metadata:
            type: file?
            description: The metadata, in JSON format, that corresponds to the data
            targetDirectory: xena/files
